@page
@model PinhuaMaster.Pages.Personnel.Files.CreateModel
@{
    ViewData["Title"] = "录入人员档案";
}
@Html.ValidationSummary()
<form method="post">
    <div class="row">
        <div class="col-md-8">
            <div class="box box-solid">
                <div class="box-body">
                    <div class="form-horizontal">
                        @*<div class="form-group has-error">
            <label class="control-label col-xs-3" asp-for="PernonnelFile.Id"></label>
            <div class="col-xs-9">
                <div class="input-group">
                    <input asp-for="PernonnelFile.Id" class="form-control" readonly />
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-danger btn-flat" style="width:40px"><i class="fa fa-map-o"></i></button>
                    </span>
                </div>
            </div>
        </div>*@
                        <div class="form-group has-error">
                            <label class="control-label col-xs-3" asp-for="PersonnelFile.State"></label>
                            <div class="col-xs-9">
                                <div class="input-group">
                                    <input asp-for="PersonnelFile.State" class="form-control" value="@(Model?.PersonnelFile?.State??"在职")" readonly />
                                    <div class="input-group-addon no-padding"><i class="fa fa-info" style="width: 38px;"></i></div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group has-error">
                            <label class="control-label col-xs-3" asp-for="PersonnelFile.Name"></label>
                            <div class="col-xs-9">
                                <div class="input-group">
                                    <input asp-for="PersonnelFile.Name" class="form-control" />
                                    <div class="input-group-addon no-padding"><i class="fa fa-info" style="width: 38px;"></i></div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group has-error">
                            <label class="control-label col-xs-3" asp-for="PersonnelFile.IdentityCard"></label>
                            <div class="col-xs-9">
                                <div class="input-group">
                                    <input asp-for="PersonnelFile.IdentityCard" class="form-control" id="idNumber" />
                                    <div class="input-group-addon no-padding"><i class="fa fa-info" style="width: 38px;"></i></div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group has-error">
                            <label class="control-label col-xs-3" asp-for="PersonnelFile.ContactNumber"></label>
                            <div class="col-xs-9">
                                <div class="input-group">
                                    <input asp-for="PersonnelFile.ContactNumber" class="form-control" />
                                    <div class="input-group-addon no-padding"><i class="fa fa-phone" style="width: 38px;"></i></div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group has-error">
                            <label class="control-label col-xs-3" asp-for="PersonnelFile.Address"></label>
                            <div class="col-xs-9">
                                <div class="input-group">
                                    <input asp-for="PersonnelFile.Address" class="form-control" />
                                    <div class="input-group-addon no-padding"><i class="fa fa-address-card" style="width: 38px;"></i></div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group has-error">
                            <label class="control-label col-xs-3" asp-for="PersonnelFile.Sex"></label>
                            <div class="col-xs-9">
                                <div class="input-group">
                                    <input asp-for="PersonnelFile.Sex" class="form-control" readonly />
                                    <div class="input-group-addon no-padding"><i class="fa fa-venus-mars" style="width: 38px;"></i></div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group has-error">
                            <label class="control-label col-xs-3" asp-for="PersonnelFile.BirthDate"></label>
                            <div class="col-xs-9">
                                <div class="input-group">
                                    <input asp-for="PersonnelFile.BirthDate" class="form-control" type="text" value="@Model?.PersonnelFile?.BirthDate?.ToString("yyyy-MM-dd")" readonly />
                                    <div class="input-group-addon no-padding"><i class="fa fa-birthday-cake" style="width: 38px;"></i></div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group has-error">
                            <label class="control-label col-xs-3" asp-for="PersonnelFile.InServiceFrom"></label>
                            <div class="col-xs-9">
                                <div class="input-group">
                                    <input asp-for="PersonnelFile.InServiceFrom" class="form-control" type="text" value="@Model?.PersonnelFile?.InServiceFrom?.ToString("yyyy-MM-dd")" data-provide="datepicker" data-date-format="yyyy-mm-dd" />
                                    <div class="input-group-addon no-padding"><i class="fa fa-calendar" style="width: 38px;"></i></div>
                                </div>
                            </div>
                        </div>
                        @*<div class="form-group has-error">
                            <label class="control-label col-xs-3" asp-for="PersonnelFile.InServiceEnd"></label>
                            <div class="col-xs-9">
                                <div class="input-group">
                                    <input asp-for="PersonnelFile.InServiceEnd" class="form-control" type="text" value="@Model?.PersonnelFile?.InServiceEnd?.ToString("yyyy-MM-dd")" readonly />
                                    <div class="input-group-addon no-padding"><i class="fa fa-calendar" style="width: 38px;"></i></div>
                                </div>
                            </div>
                        </div>*@
                        <div class="form-group has-error">
                            <label class="control-label col-xs-3" asp-for="PersonnelFile.SignedDate"></label>
                            <div class="col-xs-9">
                                <div class="input-group">
                                    <input asp-for="PersonnelFile.SignedDate" value="@DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")" class="form-control" type="text" readonly />
                                    <div class="input-group-addon no-padding"><i class="fa fa-calendar" style="width: 38px;"></i></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="box-footer">
                    <a asp-page="Index" class="btn btn-default btn-flat pull-left"><i class="fa fa-mail-reply"></i> 返回</a>
                    <button type="submit" class="btn btn-default btn-flat pull-right"><i class="fa fa-check"></i> 提交</button>

                </div>
            </div>
        </div>
    </div>
</form>

@section Scripts{
    <script type="text/javascript">
        function isIdCardNo(num) {
            var factorArr = new Array(7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2, 1);
            var parityBit = new Array("1", "0", "X", "9", "8", "7", "6", "5", "4", "3", "2");
            var varArray = new Array();
            var intValue;
            var lngProduct = 0;
            var intCheckDigit;
            var intStrLen = num.length;
            var idNumber = num;
            // initialize
            if ((intStrLen != 15) && (intStrLen != 18)) {
                return false;
            }
            // check and set value
            for (i = 0; i < intStrLen; i++) {
                varArray[i] = idNumber.charAt(i);
                if ((varArray[i] < '0' || varArray[i] > '9') && (i != 17)) {
                    return false;
                } else if (i < 17) {
                    varArray[i] = varArray[i] * factorArr[i];
                }
            }
            if (intStrLen == 18) {
                //check date
                var date8 = idNumber.substring(6, 14);
                if (isDate8(date8) == false) {
                    return false;
                }
                // calculate the sum of the products
                for (i = 0; i < 17; i++) {
                    lngProduct = lngProduct + varArray[i];
                }
                // calculate the check digit
                intCheckDigit = parityBit[lngProduct % 11];
                // check last digit
                if (varArray[17] != intCheckDigit) {
                    return false;
                }
            }
            else {        //length is 15
                //check date
                var date6 = idNumber.substring(6, 12);
                if (isDate6(date6) == false) {
                    return false;
                }
            }
            return true;
        }

        function isDate6(sDate) {
            if (!/^[0-9]{6}$/.test(sDate)) {
                return false;
            }
            var year, month, day;
            year = sDate.substring(0, 4);
            month = sDate.substring(4, 6);
            if (year < 1700 || year > 2500) return false;
            if (month < 1 || month > 12) return false;
            return true;
        }

        function isDate8(sDate) {
            if (!/^[0-9]{8}$/.test(sDate)) {
                return false;
            }
            var year, month, day;
            year = sDate.substring(0, 4);
            month = sDate.substring(4, 6);
            day = sDate.substring(6, 8);
            var iaMonthDays = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]
            if (year < 1700 || year > 2500) return false;
            if (((year % 4 == 0) && (year % 100 != 0)) || (year % 400 == 0)) iaMonthDays[1] = 29;
            if (month < 1 || month > 12) return false;
            if (day < 1 || day > iaMonthDays[month - 1]) return false;
            return true;
        }

        //给身份证文本框添加一个失去焦点事件：
        $("#idNumber").blur(function () {
            //获取身份证号码，例如：412702199301010000，这里不再判断身份证号是否合法
            var idNumber = $("#idNumber").val();
            //定义籍贯、出生日期、性别、年龄等变量
            var provinces, province, birthday, currDate, month, date, age, sex;
            if (isIdCardNo(idNumber)) {
                //一、获取籍贯，由于数据量比较大，所以这里只获取到省：
                //定义地区数组
                provinces = { 11: "北京", 12: "天津", 13: "河北", 14: "山西", 15: "内蒙古", 21: "辽宁", 22: "吉林", 23: "黑龙江", 31: "上海", 32: "江苏", 33: "浙江", 34: "安徽", 35: "福建", 36: "江西", 37: "山东", 41: "河南", 42: "湖北", 43: "湖南", 44: "广东", 45: "广西", 46: "海南", 50: "重庆", 51: "四川", 52: "贵州", 53: "云南", 54: "西藏", 61: "陕西", 62: "甘肃", 63: "青海", 64: "宁夏", 65: "新疆", 71: "台湾", 81: "香港", 82: "澳门", 91: "国外" };
                province = provinces[parseInt(idNumber.substr(0, 2))];
                //二、获取出生日期
                birthday = idNumber.substring(6, 10) + "-" + idNumber.substring(10, 12) + "-" + idNumber.substring(12, 14);
                //三、计算年龄
                currDate = new Date();
                month = currDate.getMonth() + 1;
                date = currDate.getDate();
                age = currDate.getFullYear() - idNumber.substring(6, 10) - 1;
                //判断年龄
                if (idNumber.substring(10, 12) < month || (idNumber.substring(10, 12) == month && idNumber.substring(12, 14) <= date)) {
                    age++;
                }
                //四、获取性别
                if (parseInt(idNumber.substr(16, 1)) % 2 == 1) {
                    //男
                    sex = "男";
                } else {
                    //女
                    sex = "女";
                }
            }

            //这里假定籍贯是文本框，给籍贯赋值
            $("#PersonnelFile_Address").val(province);
            //给生日文本框赋值
            $("#PersonnelFile_BirthDate").val(birthday);
            //给年龄文本框赋值
            $("#age").val(age);
            //给性别单选框赋值
            $("#PersonnelFile_Sex").val(sex);
        });
    </script>
}
